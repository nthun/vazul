# vazul - Data Blinding Package

vazul is an R package that provides functions for data blinding, including a `scramble_values()` function and two research datasets (MARP and Williams studies).

Always reference these instructions first and fallback to search or bash commands only when you encounter unexpected information that does not match the info here.

## Working Effectively

### System Requirements and Installation
- Install R and development tools:
  - `sudo apt update && sudo apt install -y r-base r-base-dev`
  - `sudo apt install -y r-cran-devtools r-cran-roxygen2 r-cran-lintr r-cran-testthat r-cran-usethis`
- R version 4.3.3 is confirmed to work correctly.

### Package Development Workflow
- **Build the package**: `R CMD build .` -- INSTANT (completes in <1 second). NEVER CANCEL.
- **Install the package**: `sudo R CMD INSTALL .` -- takes 1 second. NEVER CANCEL.
- **Generate documentation**: `R -e "devtools::document()"` -- takes 1-2 seconds. NEVER CANCEL. 
- **Check package quality**: `R CMD check <package_tarball> --no-manual` -- takes 5 seconds. NEVER CANCEL. Set timeout to 30+ seconds.
- **Style checking**: `R -e "lintr::lint_package()"` -- takes 1-2 seconds. NEVER CANCEL.

**CRITICAL TIMEOUT WARNINGS:**
- NEVER CANCEL any R package operations. Even though they complete quickly, set timeouts to 60+ seconds for build commands and 30+ seconds for check commands to account for system variations.
- Package build operations in R are typically fast but can vary on different systems.

### Testing Package Functionality
Always test the package works correctly after making changes by running all of these validation steps:

```r
library(vazul)

# Test main function with different data types
scramble_values(1:10)           # Should return numbers 1-10 in random order
scramble_values(letters[1:5])   # Should return letters a-e in random order  
scramble_values(factor(c("A","B","C"))) # Should work with factors

# Test datasets load correctly
data(marp)
dim(marp)                       # Should be [10535, 46] 
head(marp, 2)                   # Should show first 2 rows

data(williams) 
dim(williams)                   # Should be [112, 25]
head(williams, 2)               # Should show first 2 rows

# Basic exploratory analysis
length(unique(marp$country))    # Should be 24 countries
table(williams$ecology)         # Should show "Desperate: 56, Hopeful: 56"
```

## Validation

- **ALWAYS run the complete testing scenario above** after making any changes to verify functionality.
- **ALWAYS run `lintr::lint_package()`** before committing changes to check code style.
- **ALWAYS run `R CMD check <tarball> --no-manual`** to validate package structure and documentation.
- The package can be built and installed successfully, but:
  - PDF manual generation fails without pdflatex (use `--no-manual` flag)
  - Some documentation warnings exist but don't prevent functionality
  - Style warnings from lintr should be addressed when making changes

## Common Tasks

The following are critical commands and their expected outputs. Reference them to save time and avoid mistakes.

### Repository Structure
```
vazul/
├── .github/copilot-instructions.md
├── .gitignore
├── .Rbuildignore  
├── DESCRIPTION           # Package metadata
├── NAMESPACE             # Generated by roxygen2
├── LICENSE & LICENSE.md  # MIT license
├── NEWS.md               # Package changelog
├── MARP_data.csv         # Raw data (not directly used)
├── vazul.Rproj           # RStudio project file
├── R/                    # R source code
│   ├── scramble_values.R # Main blinding function
│   ├── marp.R           # MARP dataset documentation  
│   └── williams.R       # Williams dataset documentation
└── data/                # Binary data files
    ├── marp.rda         # MARP dataset (10,535 × 46)
    └── williams.rda     # Williams dataset (112 × 25)
```

### Key Package Components
- **Main Function**: `scramble_values(x)` - scrambles values in a vector without replacement
- **MARP Dataset**: Many Analysts Religion Project data (10,535 participants, 46 variables, 24 countries)
- **Williams Dataset**: Stereotyping study data (112 participants, 25 variables, 2 ecology conditions)
- **Package Version**: 0.0.0.9000 (development version)

### R CMD Build Output (Expected)
```
* checking for file './DESCRIPTION' ... OK
* preparing 'vazul':
* checking DESCRIPTION meta-information ... OK
* checking for LF line-endings in source and make files and shell scripts
* checking for empty or unneeded directories
* building 'vazul_0.0.0.9000.tar.gz'
```

### R CMD Check Status (Expected)
Running `R CMD check vazul_0.0.0.9000.tar.gz --no-manual` produces:
- Status: 2 WARNINGs (documentation cross-references and codoc mismatches)  
- These warnings don't prevent package functionality
- PDF manual generation fails without pdflatex but package works fine

### Common Style Issues (lintr findings)
- Line length warnings (lines >80 characters in documentation files)
- Indentation warnings (should use 2 spaces, not 4)
- These should be fixed when making changes to R code

## Troubleshooting

### Build Issues
- **"pdflatex is not available"**: Use `--no-manual` flag with R CMD check
- **Permission denied during install**: Use `sudo R CMD INSTALL .`
- **Internet connection warnings**: These are harmless warnings about CRAN repository access

### Testing Issues  
- **Function not found after install**: The package must be reinstalled after documentation changes
- **Data loading fails**: Ensure `data()` is called before accessing dataset variables
- **Scrambled output different each run**: This is expected behavior - scrambling uses random sampling

### Development Environment
- **No formal test suite exists**: Rely on manual validation scenarios above
- **No CI/CD pipelines**: All testing must be done manually
- **Build artifacts**: These are excluded by .gitignore (*.tar.gz, *.Rcheck/, man/)

## Important Notes

- **Always use `sudo`** for R CMD INSTALL operations due to system library permissions
- **No automated testing**: You must manually run the validation scenarios after every change
- **Documentation is generated**: The `man/` directory is created by `devtools::document()` and should not be manually edited
- **Binary data files**: The .rda files in `data/` are the actual datasets used by the package
- **Never use for loops**: Use functional programming tools, prefer base R variants to avoid dependancies.
